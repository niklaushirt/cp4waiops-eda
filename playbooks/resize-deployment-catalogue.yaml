- hosts: localhost
  connection: local
  tasks:
    - debug:
        msg: "Turbonomic Resize Catalogue"
        
    - name: üöÄ AWX - Get AWX URL
      shell: |
        export AWX_ROUTE=$(oc get route -n awx awx -o jsonpath={.spec.host})
        export AWX_URL=$(echo "https://$AWX_ROUTE")
        echo $AWX_URL
      ignore_errors: true
      register: ACT_AWX_URL

    - name: üöÄ AWX - Set Fact AWX_URL {{ ACT_AWX_URL.stdout }} 
      set_fact: AWX_URL={{ ACT_AWX_URL.stdout }} 


    - name: üöÄ AWX - Get AWX Password
      shell: |
        export ADMIN_PASSWORD=$(oc -n awx get secret awx-admin-password -o jsonpath='{.data.password}' | base64 --decode && echo)
        echo $ADMIN_PASSWORD
      ignore_errors: true
      register: ACT_AWX_PWD


    - name: üöÄ AWX - Set Fact AWX_PWD {{ ACT_AWX_PWD.stdout }} 
      set_fact: AWX_PWD={{ ACT_AWX_PWD.stdout }} 


    - name: üöÄ AWX - Create AWX Template Create Robotshop Ratings Outage
      shell: |
        export result=$(curl -X "POST" -s "{{ AWX_URL }}/api/v2/job_templates/7/launch" -u "admin:{{ AWX_PWD }}" --insecure \
        -H 'content-type: application/json' \
        -d $'{}')

        echo $result
      ignore_errors: true
      register: AWX_RESULT
      args:
        executable: /bin/bash

    - name: üõ∞Ô∏è  AWX_RESULT
      debug: 
        msg="{{ AWX_RESULT.stdout }}"


      